<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Simple Sheet PRO</title>
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#e0e0e0">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon-96x96.png">
    <style>
        /* --- åŸºæœ¬ã‚¹ã‚¿ã‚¤ãƒ« --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 8px; background-color: #FFF8E1; margin: 0; box-sizing: border-box; font-size: 16px; color: #000; }
        * { box-sizing: border-box; }
        .app-grid { display: flex; gap: 12px; max-width: 1600px; margin: 0 auto; align-items: flex-start; }
        
        /* ãƒ¡ãƒ¢å¸³ã‚¨ãƒªã‚¢ */
        .memo-container { flex: 1; min-width: 250px; background-color: #fff; padding: 12px; border-radius: 10px; box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1); height: 85vh; position: sticky; top: 8px; display: flex; flex-direction: column; }
        .memo-area { flex: 1; width: 100%; resize: none; border: 1px solid #ccc; border-radius: 8px; padding: 10px; font-size: 0.95em; line-height: 1.5; outline: none; background: #FFF2CC; color: #333; margin-bottom: 10px; }
        .memo-links { max-height: 150px; overflow-y: auto; padding: 5px; background: #f9f9f9; border-radius: 6px; border: 1px dashed #ccc; }
        .memo-link-item { display: block; padding: 6px; margin-bottom: 4px; background: #e3f2fd; color: #0d47a1; text-decoration: none; border-radius: 4px; font-size: 0.9em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .memo-link-item:hover { background: #bbdefb; }

        /* è¨ˆç®—ã‚·ãƒ¼ãƒˆ */
        .sheet-container { flex: 2; min-width: 0; background-color: #fff; padding: 12px; border-radius: 10px; box-shadow: 0 3px 12px rgba(0, 0, 0, 0.1); }
        
        /* é›»å“ */
        .side-calc { flex: 1; min-width: 260px; background: #333; padding: 12px; border-radius: 10px; color: white; height: fit-content; position: sticky; top: 8px; }

        .row { display: flex; margin-bottom: 12px; padding: 12px; border: 1px solid #ccc; border-radius: 10px; background-color: #fff; gap: 8px; }
        
        /* PCç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
        @media screen and (min-width: 1001px) {
            .row { flex-direction: row; align-items: center; justify-content: space-between; }
            .text-label-input { flex: 1.5; }
            .calc-area { flex: 1; justify-content: center; }
            .result-area { flex: 2; justify-content: flex-end; background: #f8f9fa; padding: 5px 10px; border-radius: 6px; }
            .result-text { font-size: 1.6em; }
        }

        /* â˜…ã‚¹ãƒãƒ›ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆPROç‰ˆå‘ã‘ã«æœ€é©åŒ–ï¼‰â˜… */
        @media screen and (max-width: 1000px) {
            body { padding-top: calc(env(safe-area-inset-top) + 10px) !important; padding-left: 8px; padding-right: 8px; }
            .app-grid { flex-direction: column; }
            .memo-container { width: 100%; height: auto; min-height: 200px; position: static; margin-bottom: 12px; }
            .sheet-container { width: 100%; }
            
            /* ä¸Šéƒ¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ç¸¦ä¸¦ã³ã« */
            .top-controls { flex-direction: column !important; align-items: stretch !important; gap: 8px; }
            .top-controls > div { width: 100% !important; justify-content: center; }
            
            /* PROç‰ˆç‰¹æœ‰ï¼šãƒã‚¹ã‚¿ãƒ¼è¡Œï¼ˆå…ƒã®æ•°å­—ï¼‰ã‚’ã‚¹ãƒãƒ›ã§ç¶ºéº—ã« */
            .master-row { flex-direction: column !important; align-items: stretch !important; gap: 10px; }
            .master-input { width: 100% !important; }
            
            /* ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒœã‚¿ãƒ³ã‚’ç”»é¢å¹…ã«åˆã‚ã›ã¦æœ€é©åŒ– */
            .utility-bar { justify-content: space-between; gap: 6px; }
            .util-btn { flex: 1; min-width: calc(25% - 6px); padding: 8px 4px; }
            .util-btn.manual { width: 100%; flex: none; margin-bottom: 4px; }

            .row { flex-direction: column !important; align-items: stretch !important; }
            .text-label-input { width: 100% !important; font-size: 1.1em; padding: 10px; margin-bottom: 5px; }
            
            /* è¨ˆç®—ã‚¨ãƒªã‚¢ãŒã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã«ã€æ•°å€¤ã‚’ãƒ•ãƒ¬ã‚­ã‚·ãƒ–ãƒ«ã« */
            .calc-area { width: 100% !important; flex-wrap: nowrap !important; justify-content: space-between !important; padding: 10px 0; border-top: 1px dashed #eee; border-bottom: 1px dashed #eee; }
            .multiplier-input { flex: 1; width: 100%; min-width: 0; margin: 0 5px; }
            
            .result-area { width: 100% !important; justify-content: space-between !important; background: #eefbff; padding: 12px; border-radius: 8px; margin-top: 5px; }
            .result-text { font-size: 2.2em; word-break: break-all; }
            
            /* é›»å“ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ãƒãƒ›å¯¾å¿œ */
            .side-calc { display: none; position: fixed; bottom: 80px; right: 15px; z-index: 1000; width: calc(100vw - 30px); max-width: 320px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
            .side-calc.active { display: block; }
            .calc-toggle-btn { display: block; }
            .mobile-calc-close { display: block; }
            
            /* ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆèª¬æ˜æ›¸ãƒ»ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼‰ãŒç”»é¢ã‹ã‚‰ã¯ã¿å‡ºã•ãªã„ã‚ˆã†ã« */
            .pro-modal-content { width: 95%; max-height: 90vh; overflow-y: auto; padding: 15px; }
        }

        /* ãƒ‘ãƒ¼ãƒ„é¡ */
        .text-label-input { padding: 8px; border: 2px solid #000; border-radius: 6px; font-weight: bold; color: #000; outline: none; }
        .calc-area { display: flex; align-items: center; gap: 8px; }
        .multiplier-input { width: 110px; font-size: 1.5em; padding: 8px; text-align: right; border: 3px solid #007bff; border-radius: 6px; font-weight: bold; color: #000; outline: none; }
        .result-text { font-weight: bold; color: #007bff; }
        .operator-group { display: flex; flex-direction: column; align-items: center; width: 32px; }
        .operator-control { font-size: 0.7em; background: #333; color: #fff; width: 100%; height: 20px; display: flex; justify-content: center; align-items: center; border-radius: 3px; cursor: pointer; }
        .operator-display { font-size: 1.6em; font-weight: bold; text-align: center; color: #000; height: 35px; line-height: 35px; width: 100%; }
        .percent-toggle, .base-toggle { border: 2px solid #ccc; border-radius: 6px; width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; cursor: pointer; font-weight: bold; background: #fff; font-size: 1.3em; flex-shrink: 0; color: #000; user-select: none; }
        .percent-toggle.active { background: #dc3545; color: #fff; border-color: #dc3545; }
        .base-toggle.chain { background: #007bff; color: #fff; border-color: #007bff; }
        .action-btn { border: none; background: none; cursor: pointer; font-size: 1.8em; opacity: 0.7; padding: 5px; }
        .master-row { padding: 12px; margin-bottom: 12px; border: 3px solid #dc3545; border-radius: 10px; background-color: #fff; display: flex; align-items: center; justify-content: space-between; }
        .master-input { width: 45%; padding: 8px; border: 2px solid #dc3545; border-radius: 6px; font-size: 1.5em; text-align: right; font-weight: bold; color: #000; outline: none; }
        .storage-bar { background: #dee2e6; border: 2px solid #666; border-radius: 10px; padding: 10px; margin-bottom: 12px; display: flex; flex-direction: column; gap: 8px; }
        .storage-controls { display: flex; align-items: center; gap: 10px; }
        .save-btn-main { background: #e67e22; color: white; border: none; padding: 8px 15px; border-radius: 6px; font-weight: bold; cursor: pointer; white-space: nowrap; }
        .edit-toggle-btn { background: #6c757d; color: white; border: none; padding: 8px 12px; border-radius: 6px; font-weight: bold; cursor: pointer; font-size: 1.2em; min-width: 50px; }
        .edit-toggle-btn.active { background: #dc3545; }
        .save-list-container { display: flex; gap: 6px; overflow-x: auto; padding: 4px 0; min-height: 45px; }
        .save-chip { background: #fff; border: 2px solid #007bff; color: #000; padding: 6px 14px; border-radius: 20px; font-size: 0.85em; font-weight: bold; white-space: nowrap; display: flex; align-items: center; gap: 8px; cursor: pointer; user-select: none; }
        .save-chip .del-icon { display: none; color: #dc3545; font-size: 1.3em; }
        .editing .save-chip { border-style: dashed; opacity: 0.8; }
        .editing .save-chip .del-icon { display: inline; }
        .utility-bar { display: flex; justify-content: center; gap: 6px; margin-bottom: 12px; flex-wrap: wrap; }
        .util-btn { border: none; background: #6c757d; color: white; padding: 8px 12px; border-radius: 6px; cursor: pointer; font-size: 0.85em; font-weight: bold; min-width: 60px; }
        .util-btn.manual { background: #17a2b8; width: auto; }
        .util-btn.reset { background: #dc3545; }
        .calc-display-wrap { position: relative; margin-bottom: 10px; }
        .calc-display { width: 100%; height: 52px; background: #222; color: #fff; text-align: right; font-size: 1.8em; padding: 8px 45px 8px 8px; border-radius: 6px; border: none; outline: none; }
        .calc-copy-btn-in { position: absolute; right: 5px; top: 5px; bottom: 5px; width: 40px; background: #007bff; border: none; border-radius: 4px; font-size: 1.2em; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0.9; color: white; }
        .calc-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .calc-btn { padding: 15px 5px; border: none; border-radius: 6px; cursor: pointer; font-size: 1.25em; font-weight: bold; background: #555; color: white; }
        .calc-btn.op { background: #f39c12; }
        .calc-btn.equal { background: #27ae60; grid-column: span 2; }
        .calc-btn.clear { background: #c0392b; }
        #saveMessage { position: fixed; top: 15px; left: 50%; transform: translateX(-50%); background: #000; color: #fff; padding: 12px 25px; border-radius: 25px; opacity: 0; transition: opacity 0.3s; z-index: 2000; pointer-events: none; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .calc-toggle-btn { display: none; position: fixed; bottom: 15px; right: 15px; width: 60px; height: 60px; border-radius: 50%; background: #333; color: white; border: none; font-size: 28px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); z-index: 1001; cursor: pointer; }
        .mobile-calc-close { display: none; background: none; border: none; color: white; font-size: 1.5em; cursor: pointer; }
        .pro-modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 3000; justify-content: center; align-items: center; padding: 20px; }
        .pro-modal-overlay.active { display: flex; }
        .pro-modal-content { background: #fff; padding: 25px; border-radius: 15px; text-align: center; max-width: 450px; width: 100%; box-shadow: 0 5px 20px rgba(0,0,0,0.3); animation: popIn 0.3s ease; }
        .pro-title { font-size: 1.4em; font-weight: bold; margin-bottom: 10px; color: #333; }
        .pro-desc { color: #666; margin-bottom: 20px; line-height: 1.6; text-align: left; white-space: pre-wrap; font-size: 0.95em; }
        .pro-btn-buy { display: block; width: 100%; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); color: white; font-weight: bold; text-decoration: none; border-radius: 25px; margin-bottom: 10px; border: none; cursor: pointer; font-size: 1.1em; }
        .pro-btn-close { background: none; border: none; color: #999; cursor: pointer; text-decoration: underline; font-size: 0.9em; }
        .text-area-import { width: 100%; height: 120px; padding: 10px; margin-bottom: 15px; background: #f9f9f9; border: 1px solid #ccc; border-radius: 8px; font-size: 0.9em; color: #333; resize: none; }
        .title-pro-btn { display: inline-flex; align-items: center; justify-content: center; gap: 6px; background: linear-gradient(135deg, #1a237e 0%, #000 100%); color: white; text-decoration: none; padding: 8px 20px; border-radius: 20px; font-weight: bold; font-size: 0.9em; box-shadow: 0 3px 6px rgba(0,0,0,0.15); margin: 0 auto 15px auto; transition: transform 0.2s; border:none; cursor:pointer; }
    </style>
</head>
<body onload="init()">

    <div id="startLockScreen" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a237e; color: #fff; z-index: 99999; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center;">
        <h2 style="font-size: 24px; margin-bottom: 20px;">ğŸ’ Simple Sheet PRO</h2>
        <p style="margin-bottom: 10px;">Enter Passcode</p>
        <input type="password" id="inputPass" placeholder="****" style="font-size: 24px; padding: 10px; border-radius: 8px; border: none; text-align: center; width: 200px; margin-bottom: 20px; color:#000;">
        <button onclick="checkStartPass()" style="font-size: 18px; padding: 12px 40px; border-radius: 30px; border: none; background: #28a745; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.3);">Unlock</button>
        <p style="margin-top: 30px; font-size: 12px; opacity: 0.8;">(Passcode is in the Android App)</p>
    </div>

    <div id="saveMessage"></div>

    <div id="manualModal" class="pro-modal-overlay">
        <div class="pro-modal-content">
            <div id="manTitle" class="pro-title" style="text-align:center; border-bottom:1px solid #eee; padding-bottom:10px;">Manual</div>
            <div id="manBody" class="pro-desc" style="margin-top:15px; max-height: 400px; overflow-y: auto;"></div>
            <button class="pro-btn-close" onclick="closeModal('manualModal')" id="manClose" style="width:100%; text-decoration:none; background:#eee; padding:10px; border-radius:20px; font-weight:bold; color:#555;">OK</button>
        </div>
    </div>

    <div id="importModal" class="pro-modal-overlay">
        <div class="pro-modal-content" style="max-width:350px;">
            <div class="pro-title" id="impTitle">Import Data</div>
            <div class="pro-desc" id="impDesc" style="text-align:center; margin-bottom:10px;">Paste data here:</div>
            
            <textarea id="importText" class="text-area-import" placeholder='Paste code here...' autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"></textarea>
            
            <button class="pro-btn-buy" id="btnDoImport" onclick="executeImport()" style="background: #007bff;">Load Data</button>
            <button class="pro-btn-close" id="btnCloseImp" onclick="closeModal('importModal')">Close</button>
        </div>
    </div>
    
    <button class="calc-toggle-btn" onclick="toggleCalc()">ğŸ§®</button>

    <div class="app-grid">
        <div class="memo-container">
            <h3 id="memoTitle" style="margin: 0 0 10px 0; font-size: 1.1em; text-align: center; color: #555;">ğŸ“ Memo</h3>
            <textarea id="memoArea" class="memo-area" placeholder="Write notes here..." oninput="updateMemoLinks(); saveSettings();"></textarea>
            <div id="memoLinks" class="memo-links"></div>
        </div>

        <div class="sheet-container">
            <div class="top-controls" style="display:flex; justify-content: space-between; align-items: center; margin-bottom:10px; flex-wrap: wrap; gap:8px;">
                <div style="flex:1; display:flex; align-items:center; border:2px solid #000; border-radius:6px; padding:6px 10px; min-width:140px; background:#fff;">
                    <input type="text" id="masterLabel" style="border:none; outline:none; font-weight:bold; width:100%; color:#000;" oninput="saveSettings()">
                </div>
                <div style="display:flex; gap:5px; align-items:center;">
                    <div id="langContainer" style="display:flex; gap:3px; flex-wrap: wrap;"></div>
                </div>
            </div>

            <div class="storage-bar">
                <div class="storage-controls">
                    <button class="save-btn-main" onclick="saveToMemory()">ğŸ’¾ <span id="btnSaveMemory">Save</span></button>
                    <button id="editToggle" class="edit-toggle-btn" onclick="toggleEditMode()">ğŸ—‘ï¸</button>
                </div>
                <div id="saveList" class="save-list-container"></div>
            </div>

            <h2 id="title" style="font-weight: bold; margin-bottom: 15px; text-align:center;">Simple Sheet PRO</h2>

            <div class="utility-bar">
                <button class="util-btn manual" style="width: auto; background:#17a2b8;" onclick="openManual()" id="btnManual">ğŸ“– Manual</button>
                <button class="util-btn" onclick="clearNumbers()">ğŸ§¹ <span id="btnClear">Clear</span></button>
                <button class="util-btn" onclick="exportData()">ğŸ“¤ <span id="btnExport">Exp</span></button>
                <button class="util-btn" onclick="openImport()">ğŸ“¥ <span id="btnImport">Imp</span></button>
                <button class="util-btn reset" onclick="fullReset()">ğŸ”„ <span id="btnReset">Reset</span></button>
            </div>

            <div id="main-sheet-mode">
                <div class="master-row">
                    <label id="masterLabelStart" style="font-weight:bold; color:#dc3545;">ğŸ  Base</label>
                    <input type="number" id="masterInput" class="master-input" step="any" placeholder="" oninput="updateDisplay()">
                </div>
                <div id="rows-container"></div>
                <div style="text-align: center; margin-top: 15px; display: flex; gap: 8px;">
                    <button class="mode-button" id="addBtn" style="background:#28a745; color:white; flex-direction:row; min-height:auto; width:100%; justify-content:center; border:none; border-radius:6px; padding:12px; font-weight:bold; font-size:1.1rem; cursor:pointer;" onclick="addRow()">+ Row</button>
                    <button class="mode-button" id="copyBtn" style="background:#007bff; color:white; flex-direction:row; min-height:auto; width:100%; justify-content:center; border:none; border-radius:6px; padding:12px; font-weight:bold; font-size:1.1rem; cursor:pointer;" onclick="copyPage()">ğŸ“‹ Copy All</button>
                </div>
            </div>
        </div>

        <div id="sideCalc" class="side-calc">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3 id="ui-calcTitle" style="margin:0;">Calculator</h3>
                <button class="mobile-calc-close" onclick="toggleCalc()">Ã—</button>
            </div>
            <div class="calc-display-wrap">
                <input type="text" id="calcDisplay" class="calc-display" readonly value="0">
                <button class="calc-copy-btn-in" onclick="copyCalcResult()">ğŸ“‹</button>
            </div>
            <div class="calc-buttons">
                <button class="calc-btn clear" onclick="calcInput('AC')">AC</button>
                <button class="calc-btn op" onclick="calcInput('%')">%</button>
                <button class="calc-btn op" onclick="calcInput('/')">Ã·</button>
                <button class="calc-btn op" onclick="calcInput('*')">Ã—</button>
                <button class="calc-btn" onclick="calcInput('7')">7</button>
                <button class="calc-btn" onclick="calcInput('8')">8</button>
                <button class="calc-btn" onclick="calcInput('9')">9</button>
                <button class="calc-btn op" onclick="calcInput('-')">-</button>
                <button class="calc-btn" onclick="calcInput('4')">4</button>
                <button class="calc-btn" onclick="calcInput('5')">5</button>
                <button class="calc-btn" onclick="calcInput('6')">6</button>
                <button class="calc-btn op" onclick="calcInput('+')">+</button>
                <button class="calc-btn" onclick="calcInput('1')">1</button>
                <button class="calc-btn" onclick="calcInput('2')">2</button>
                <button class="calc-btn" onclick="calcInput('3')">3</button>
                <button class="calc-btn" onclick="calcInput('.')">.</button>
                <button class="calc-btn" onclick="calcInput('0')">0</button>
                <button class="calc-btn clear" style="background:#e67e22;" onclick="calcInput('BS')">âŒ«</button>
                <button class="calc-btn equal" onclick="calcResult()">=</button>
            </div>
        </div>
    </div>

    <script>
        const fullManual = {
            ja: "Simple Sheet ã«ã¤ã„ã¦\n\né›»å“ã‚ˆã‚Šæ•´ç†ã§ãã¦ã€\nã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã»ã©è¤‡é›‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\n\nSimple Sheetã¯\nè¨ˆç®—ã‚’æ•´ç†ã—ã¦æ®‹ã™ãŸã‚ã®ã‚¢ãƒ—ãƒªã§ã™ã€‚\n\nè¶³ã™ã€å¼•ãã€æ›ã‘ã‚‹ã€å‰²ã‚‹ã€\nã“ã®4ã¤ã®è¨ˆç®—ã§æ§‹æˆã—ã¾ã™ã€‚\nè¨ˆç®—ã®æµã‚Œã¯ãã®ã¾ã¾æ®‹ã‚Šã¾ã™ã€‚\n\nã€è¨ˆç®—ãƒ¢ãƒ¼ãƒ‰ã®åˆ‡æ›¿ã€‘\nğŸ  å…ƒã®æ•°å­—: ä¸€ç•ªä¸Šã®ã€Œå…ƒã®æ•°å­—ã€ã‚’ä½¿ã„ã¾ã™ã€‚\nğŸ”— ãƒã‚§ãƒ¼ãƒ³: ä¸€ã¤ä¸Šã®è¡Œã®è¨ˆç®—çµæœã‚’ä½¿ã„ã¾ã™ã€‚\n\nãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚\n\nã€ã‚ªãƒ¼ãƒ«ã‚³ãƒ”ãƒ¼ (è¡¨ã¨ã—ã¦ä½¿ã†)ã€‘\nè¨ˆç®—çµæœã‚’è¡¨ã¨ã—ã¦ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚\nExcel ã‚„ Google ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è²¼ã‚Šä»˜ã‘ã¦ä½¿ãˆã¾ã™ã€‚\nâ€»é•·æ–‡ãŒéš ã‚Œãªã„ã‚ˆã†ã€é …ç›®åã¨æ•°å­—ã®é–“ã«ç©ºç™½åˆ—ã‚’æŒŸã‚“ã§ã„ã¾ã™ã€‚\n(JSONã‚³ãƒ¼ãƒ‰ã¯å«ã¾ã‚Œã¾ã›ã‚“)\n\nã€å‡ºåŠ› (ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä½¿ã†)ã€‘\nè¨ˆç®—ãƒ‡ãƒ¼ã‚¿ãã®ã‚‚ã®ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚\nSimple Sheet ã«è²¼ã‚Šä»˜ã‘ã¦ã€å…±æœ‰ãƒ»å†ç·¨é›†ã§ãã¾ã™ã€‚\n\nã€èª­è¾¼(ã‚¤ãƒ³ãƒãƒ¼ãƒˆ)ã€‘\nã‚³ãƒ”ãƒ¼ã—ãŸãƒ†ã‚­ã‚¹ãƒˆã‚’èª­è¾¼ç”»é¢ã«è²¼ã‚Šä»˜ã‘ã¾ã™ã€‚\n\næŒ¨æ‹¶æ–‡ãªã©ãŒæ··ã–ã£ã¦ã„ã¦ã‚‚ã€è‡ªå‹•ã§ãƒ‡ãƒ¼ã‚¿ã ã‘ã‚’æŠœãå‡ºã—ã¾ã™ã€‚\n\nã€ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦ã€‘\nãƒ»ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã¯ã€ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ã®ã¿ä¿å­˜ã•ã‚Œã¾ã™ã€‚\nãƒ»ãƒ–ãƒ©ã‚¦ã‚¶ã®å±¥æ­´å‰Šé™¤ãªã©ã§æ¶ˆãˆã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
            en: "About Simple Sheet\n\nMore organized than a calculator,\nLess complicated than a spreadsheet.\n\nSimple Sheet is an app for organizing and keeping your calculations.\n\nIt consists of 4 operations: Add, Subtract, Multiply, Divide.\nThe flow of calculation remains.\n\nã€Switching Calc Modeã€‘\nğŸ  Base: Uses the top 'Base Value'.\nğŸ”— Chain: Uses the result of the row directly above.\nTap the button to switch.\n\nã€Copy All (Use as Table)ã€‘\nCopies the result as a table.\nYou can paste it into Excel or Google Sheets.\n*An empty column is added between Item and Number to prevent text hiding.\n(JSON code is not included)\n\nã€Export (Use as Data)ã€‘\nCopies the calculation data code.\nPaste into Simple Sheet to share or re-edit.\n\nã€Importã€‘\nPaste the copied text into the import screen.\n\nã€About Saved Dataã€‘\nãƒ»Data is saved only in this browser.\nãƒ»Data may be lost if browser history/cache is cleared.",
            zh: "å…³äº Simple Sheet\n\næ¯”è®¡ç®—å™¨æ›´æœ‰æ¡ç†ï¼Œ\nä¸åƒç”µå­è¡¨æ ¼é‚£ä¹ˆå¤æ‚ã€‚\n\nSimple Sheet æ˜¯ä¸€æ¬¾ç”¨äºæ•´ç†å’Œä¿å­˜è®¡ç®—çš„åº”ç”¨ç¨‹åºã€‚\n\nç”±åŠ ã€å‡ã€ä¹˜ã€é™¤å››ç§è¿ç®—ç»„æˆã€‚ä¿ç•™è®¡ç®—æµç¨‹ã€‚\n\nã€æ¨¡å¼åˆ‡æ¢ã€‘\nğŸ  åˆå§‹å€¼: ä½¿ç”¨é¡¶éƒ¨çš„â€œåˆå§‹å€¼â€ã€‚\nğŸ”— é“¾: ä½¿ç”¨ä¸Šä¸€è¡Œçš„ç»“æœã€‚\n\nã€å…¨éƒ¨å¤åˆ¶ (ä½œè¡¨ä½¿ç”¨)ã€‘\nå°†è®¡ç®—ç»“æœä½œä¸ºè¡¨æ ¼å¤åˆ¶ã€‚\nå¯ç²˜è´´åˆ° Excel æˆ– Google Sheets ä¸­ä½¿ç”¨ã€‚\n*åœ¨é¡¹ç›®åå’Œæ•°å­—ä¹‹é—´æ’å…¥ç©ºåˆ—ä»¥é˜²æ­¢æ–‡å­—è¢«é®æŒ¡ã€‚\n(ä¸åŒ…å«JSONä»£ç )\n\nã€å¯¼å‡º (ä½œæ•°æ®ä½¿ç”¨)ã€‘\nå¤åˆ¶è®¡ç®—æ•°æ®æœ¬èº«ã€‚\nç²˜è´´åˆ° Simple Sheet ä¸­å³å¯åˆ†äº«æˆ–é‡æ–°ç¼–è¾‘ã€‚\n\nã€å¯¼å…¥ã€‘\nå°†å¤åˆ¶çš„æ–‡æœ¬ç²˜è´´åˆ°å¯¼å…¥ç”»é¢ã€‚\n\nã€å…³äºä¿å­˜æ•°æ®ã€‘\nãƒ»æ•°æ®ä»…ä¿å­˜åœ¨æ­¤æµè§ˆå™¨ä¸­ã€‚",
            ko: "Simple Sheet ì •ë³´\n\nê³„ì‚°ê¸°ë³´ë‹¤ ì²´ê³„ì ì´ê³  ìŠ¤í”„ë ˆë“œì‹œíŠ¸ë³´ë‹¤ ê°„ë‹¨í•©ë‹ˆë‹¤.\n\nSimple SheetëŠ” ê³„ì‚°ì„ ì •ë¦¬í•˜ì—¬ ë‚¨ê¸°ê¸° ìœ„í•œ ì•±ì…ë‹ˆë‹¤.\n\në”í•˜ê¸°, ë¹¼ê¸°, ê³±í•˜ê¸°, ë‚˜ëˆ„ê¸° 4ê°€ì§€ ê³„ì‚°ìœ¼ë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ê³„ì‚° íë¦„ì´ ê·¸ëŒ€ë¡œ ë‚¨ìŠµë‹ˆë‹¤.\n\nã€ëª¨ë“œ ì „í™˜ã€‘\nğŸ  ê¸°ì¤€ê°’: ë§¨ ìœ„ì˜ 'ê¸°ì¤€ê°’'ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.\nğŸ”— ì²´ì¸: ë°”ë¡œ ìœ— ì¤„ì˜ ê²°ê³¼ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.\n\nã€ì „ì²´ ë³µì‚¬ (í‘œë¡œ ì‚¬ìš©)ã€‘\nê³„ì‚° ê²°ê³¼ë¥¼ í‘œë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.\nExcelì´ë‚˜ Google ìŠ¤í”„ë ˆë“œì‹œíŠ¸ì— ë¶™ì—¬ë„£ì–´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n*ê¸´ í…ìŠ¤íŠ¸ê°€ ê°€ë ¤ì§€ì§€ ì•Šë„ë¡ ë¹ˆ ì—´ì„ ì¶”ê°€í•©ë‹ˆë‹¤.\n(JSON ì½”ë“œëŠ” í¬í•¨ë˜ì§€ ì•ŠìŒ)\n\nã€ì¶œë ¥ (ë°ì´í„°ë¡œ ì‚¬ìš©)ã€‘\nê³„ì‚° ë°ì´í„° ìì²´ë¥¼ ë³µì‚¬í•©ë‹ˆë‹¤.\nSimple Sheetì— ë¶™ì—¬ë„£ì–´ ê³µìœ  ë° ì¬í¸ì§‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nã€ë¶ˆëŸ¬ì˜¤ê¸°(Import)ã€‘\në³µì‚¬í•œ í…ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ê¸° í™”ë©´ì— ë¶™ì—¬ë„£ìŠµë‹ˆë‹¤.\n\nã€ì €ì¥ ë°ì´í„°ì— ëŒ€í•´ã€‘\nãƒ»ì €ì¥ ë°ì´í„°ëŠ” ì´ ë¸Œë¼ìš°ì €ì—ë§Œ ì €ì¥ë©ë‹ˆë‹¤.",
            es: "Sobre Simple Sheet\n\nMÃ¡s organizado que una calculadora, menos complejo que una hoja de cÃ¡lculo.\n\nSimple Sheet es una app para organizar y guardar cÃ¡lculos.\nConsta de sumar, restar, multiplicar y dividir. El flujo del cÃ¡lculo se mantiene.\n\nã€Cambio de modoã€‘\nğŸ  Valor Base: Usa el 'Valor Base' superior.\nğŸ”— Cadena: Usa el resultado de la fila anterior.\n\nã€Copiar Todo (Como tabla)ã€‘\nCopia el resultado como tabla.\nPegar en Excel o Google Sheets.\n*Se inserta una columna vacÃ­a para no ocultar texto largo.\n(No incluye cÃ³digo JSON)\n\nã€Exportar (Como datos)ã€‘\nCopia los datos del cÃ¡lculo.\nPegar en Simple Sheet para compartir o reeditar.\n\nã€Importarã€‘\nPegue el texto copiado en la pantalla de importaciÃ³n.\n\nã€Datos Guardadosã€‘\nãƒ»Los datos se guardan solo en este navegador.",
            pt: "Sobre o Simple Sheet\n\nMais organizado que uma calculadora, menos complicado que uma planilha.\n\nSimple Sheet Ã© um app para organizar e manter cÃ¡lculos.\nConsiste em somar, subtrair, multiplicar e dividir. O fluxo permanece.\n\nã€MudanÃ§a de Modoã€‘\nğŸ  Valor Base: Usa o valor do topo.\nğŸ”— Cadeia: Usa o resultado da linha anterior.\n\nã€Copiar Tudo (Tabela)ã€‘\nCopia o resultado como tabela.\n*Insere coluna vazia para nÃ£o ocultar texto longo.\n(Sem cÃ³digo JSON)\n\nã€Exportar (Dados)ã€‘\nCopia os dados de cÃ¡lculo.\nCole no Simple Sheet para compartilhar.\n\nã€Importarã€‘\nCole o texto na tela de importaÃ§Ã£o.\n\nã€Sobre Dados Salvosã€‘\nãƒ»Salvo apenas neste navegador.",
            fr: "Ã€ propos de Simple Sheet\n\nMieux organisÃ© qu'une calculatrice, moins complexe qu'un tableur.\n\nSimple Sheet sert Ã  organiser et conserver vos calculs.\nConstituÃ© de : addition, soustraction, multiplication, division. Le fil reste visible.\n\nã€Changement de modeã€‘\nğŸ  Valeur Base : Utilise la valeur supÃ©rieure.\nğŸ”— ChaÃ®ne : Utilise le rÃ©sultat prÃ©cÃ©dent.\n\nã€Tout Copier (Tableau)ã€‘\nCopie le rÃ©sultat sous forme de tableau.\n*Une colonne vide est ajoutÃ©e pour le texte long.\n(Code JSON non inclus)\n\nã€Exporter (DonnÃ©es)ã€‘\nCopie les donnÃ©es de calcul.\nÃ€ coller dans Simple Sheet pour partager.\n\nã€Importerã€‘\nCollez le texte dans l'Ã©cran d'importation.\n\nã€Ã€ propos des donnÃ©esã€‘\nãƒ»StockÃ©es uniquement sur ce navigateur.",
            ru: "Ğ Simple Sheet\n\nĞ£Ğ´Ğ¾Ğ±Ğ½ĞµĞµ, Ñ‡ĞµĞ¼ ĞºĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€, Ğ¿Ñ€Ğ¾Ñ‰Ğµ, Ñ‡ĞµĞ¼ Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°.\n\nSimple Sheet â€” Ğ¿Ñ€Ğ¸Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€Ğ°ÑÑ‡ĞµÑ‚Ğ¾Ğ².\nĞ¡Ğ»Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ, Ğ²Ñ‹Ñ‡Ğ¸Ñ‚Ğ°Ğ½Ğ¸Ğµ, ÑƒĞ¼Ğ½Ğ¾Ğ¶ĞµĞ½Ğ¸Ğµ, Ğ´ĞµĞ»ĞµĞ½Ğ¸Ğµ. Ğ¥Ğ¾Ğ´ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğ¹ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ÑÑ.\n\nã€Ğ ĞµĞ¶Ğ¸Ğ¼Ñ‹ã€‘\nğŸ  Ğ‘Ğ°Ğ·Ğ°: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ²ĞµÑ€Ñ…Ğ½ĞµĞµ Ğ·Ğ½Ğ°Ñ‡ĞµĞ½Ğ¸Ğµ.\nğŸ”— Ğ¦ĞµĞ¿ÑŒ: Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ĞµĞ¹ ÑÑ‚Ñ€Ğ¾ĞºĞ¸.\n\nã€ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ²ÑĞµ (Ğ¢Ğ°Ğ±Ğ»Ğ¸Ñ†Ğ°)ã€‘\nĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ ĞºĞ°Ğº Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ.\n*Ğ’ÑÑ‚Ğ°Ğ²Ğ»ÑĞµÑ‚ÑÑ Ğ¿ÑƒÑÑ‚Ğ¾Ğ¹ ÑÑ‚Ğ¾Ğ»Ğ±ĞµÑ† Ğ´Ğ»Ñ Ğ´Ğ»Ğ¸Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ñ‚ĞµĞºÑÑ‚Ğ°.\n(Ğ‘ĞµĞ· JSON ĞºĞ¾Ğ´Ğ°)\n\nã€Ğ­ĞºÑĞ¿Ğ¾Ñ€Ñ‚ (Ğ”Ğ°Ğ½Ğ½Ñ‹Ğµ)ã€‘\nĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ Ğ²Ñ‹Ñ‡Ğ¸ÑĞ»ĞµĞ½Ğ¸Ğ¹.\nĞ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ğ² Simple Sheet Ğ´Ğ»Ñ Ğ¾Ğ±Ğ¼ĞµĞ½Ğ°.\n\nã€Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚ã€‘\nĞ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ Ñ‚ĞµĞºÑÑ‚ Ğ² ÑĞºÑ€Ğ°Ğ½ Ğ¸Ğ¼Ğ¿Ğ¾Ñ€Ñ‚Ğ°.\n\nã€Ğ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…ã€‘\nãƒ»Ğ¥Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ² ÑÑ‚Ğ¾Ğ¼ Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğµ.",
            de: "Ãœber Simple Sheet\n\nÃœbersichtlicher als ein Taschenrechner, einfacher als eine Tabelle.\n\nSimple Sheet organisiert Berechnungen.\nAddieren, Subtrahieren, Multiplizieren, Dividieren. Der Weg bleibt erhalten.\n\nã€Moduswechselã€‘\nğŸ  Basiswert: Verwendet den oberen Wert.\nğŸ”— Kette: Verwendet das vorherige Ergebnis.\n\nã€Alles Kopieren (Tabelle)ã€‘\nKopiert das Ergebnis als Tabelle.\n*FÃ¼gt leere Spalte fÃ¼r langen Text ein.\n(Ohne JSON-Code)\n\nã€Exportieren (Daten)ã€‘\nKopiert die Berechnungsdaten.\nZum Teilen in Simple Sheet einfÃ¼gen.\n\nã€Importierenã€‘\nText in den Import-Bildschirm einfÃ¼gen.\n\nã€Gespeicherte Datenã€‘\nãƒ»Nur in diesem Browser gespeichert."
        };

        const languageMap = {
            en: { title: "Simple Sheet PRO", masterLabelName: "Title", masterLabelStart: "ğŸ  Base", rowLabel: "Item Name", copyMsg: "Copied!", btnClear: "Clear", btnExport: "Exp", btnImport: "Imp", btnReset: "Reset", confirmReset: "Reset all?", addRow: "+ Row", copyAll: "ğŸ“‹ Copy All", calcTitle: "Calculator", btnSave: "ğŸ’¾ Save", btnDone: "Done",
                  manual: "ğŸ“– Manual", btnClose: "Close", msgSave: "Saved!", msgLoad: "Loaded!", confirmDel: "Delete?", msgExported: "Data Code Copied!", msgError: "Error", impTitle:"Import Data", impDesc:"Paste data here:", btnLoad:"Load Data", memoTitle: "ğŸ“ MEMO" },
            ja: { title: "Simple Sheet PRO", masterLabelName: "ã‚¿ã‚¤ãƒˆãƒ«", masterLabelStart: "ğŸ  å…ƒã®æ•°å­—", rowLabel: "é …ç›®å", copyMsg: "ã‚³ãƒ”ãƒ¼å®Œäº†", btnClear: "ã‚¯ãƒªã‚¢", btnExport: "å‡ºåŠ›", btnImport: "èª­è¾¼", btnReset: "åˆæœŸåŒ–", confirmReset: "å…¨å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ", addRow: "+ è¡Œã‚’è¿½åŠ ", copyAll: "ğŸ“‹ ã‚ªãƒ¼ãƒ«ã‚³ãƒ”ãƒ¼", calcTitle: "é›»å“", btnSave: "ğŸ’¾ è¨˜æ†¶", btnDone: "å®Œäº†",
                  manual: "ğŸ“– èª¬æ˜æ›¸", btnClose: "é–‰ã˜ã‚‹", msgSave: "ä¿å­˜ã—ã¾ã—ãŸ", msgLoad: "èª­ã¿è¾¼ã¿ã¾ã—ãŸ", confirmDel: "å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ", msgExported: "ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ", msgError: "ã‚¨ãƒ©ãƒ¼", impTitle:"ãƒ‡ãƒ¼ã‚¿ã®èª­è¾¼", impDesc:"ã“ã“ã«ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘:", btnLoad:"èª­è¾¼é–‹å§‹", memoTitle: "ğŸ“ ãƒ¡ãƒ¢" },
            zh: { title: "Simple Sheet PRO", masterLabelName: "æ ‡é¢˜", masterLabelStart: "ğŸ  åˆå§‹å€¼", rowLabel: "é¡¹ç›®åç§°", copyMsg: "å·²å¤åˆ¶", btnClear: "æ¸…é™¤", btnExport: "å¯¼å‡º", btnImport: "å¯¼å…¥", btnReset: "é‡ç½®", confirmReset: "ç¡®è®¤é‡ç½®æ‰€æœ‰æ•°æ®ï¼Ÿ", addRow: "+ æ·»åŠ è¡Œ", copyAll: "ğŸ“‹ å¤åˆ¶", calcTitle: "è®¡ç®—å™¨", btnSave: "ğŸ’¾ ä¿å­˜", btnDone: "å®Œæˆ",
                  manual: "ğŸ“– è¯´æ˜ä¹¦", btnClose: "å…³é—­", msgSave: "å·²ä¿å­˜", msgLoad: "å·²åŠ è½½", confirmDel: "åˆ é™¤ï¼Ÿ", msgExported: "ä»£ç å·²å¤åˆ¶", msgError: "é”™è¯¯", impTitle:"å¯¼å…¥æ•°æ®", impDesc:"ç²˜è´´ä»£ç :", btnLoad:"åŠ è½½", memoTitle: "ğŸ“ å¤‡å¿˜å½•" },
            ko: { title: "Simple Sheet PRO", masterLabelName: "ì œëª©", masterLabelStart: "ğŸ  ê¸°ì¤€ê°’", rowLabel: "í•­ëª© ì´ë¦„", copyMsg: "ë³µì‚¬ë¨", btnClear: "ì§€ìš°ê¸°", btnExport: "ë‚´ë³´ë‚´ê¸°", btnImport: "ê°€ì ¸ì˜¤ê¸°", btnReset: "ì´ˆê¸°í™”", confirmReset: "ì „ì²´ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?", addRow: "+ í–‰ ì¶”ê°€", copyAll: "ğŸ“‹ ë³µì‚¬", calcTitle: "ê³„ì‚°ê¸°", btnSave: "ğŸ’¾ ì €ì¥", btnDone: "ì™„ë£Œ",
                  manual: "ğŸ“– ì„¤ëª…ì„œ", btnClose: "ë‹«ê¸°", msgSave: "ì €ì¥ë¨", msgLoad: "ë¡œë“œë¨", confirmDel: "ì‚­ì œ?", msgExported: "ì½”ë“œ ë³µì‚¬ë¨", msgError: "ì˜¤ë¥˜", impTitle:"ë°ì´í„° ê°€ì ¸ì˜¤ê¸°", impDesc:"ì½”ë“œ ë¶™ì—¬ë„£ê¸°:", btnLoad:"ë¡œë“œ", memoTitle: "ğŸ“ ë©”ëª¨" },
            es: { title: "Simple Sheet PRO", masterLabelName: "TÃ­tulo", masterLabelStart: "ğŸ  Valor Base", rowLabel: "Nombre del Ã­tem", copyMsg: "Â¡Copiado!", btnClear: "Borrar", btnExport: "Exp", btnImport: "Imp", btnReset: "Reiniciar", confirmReset: "Â¿Reiniciar todo?", addRow: "+ Fila", copyAll: "ğŸ“‹ Copiar", calcTitle: "Calculadora", btnSave: "ğŸ’¾ Guardar", btnDone: "Listo",
                  manual: "ğŸ“– Manual", btnClose: "Cerrar", msgSave: "Â¡Guardado!", msgLoad: "Â¡Cargado!", confirmDel: "Â¿Eliminar?", msgExported: "Â¡CÃ³digo copiado!", msgError: "Error", impTitle:"Importar", impDesc:"Pegar cÃ³digo:", btnLoad:"Cargar", memoTitle: "ğŸ“ Nota" },
            pt: { title: "Simple Sheet PRO", masterLabelName: "TÃ­tulo", masterLabelStart: "ğŸ  Valor Base", rowLabel: "Nome do Item", copyMsg: "Copiado!", btnClear: "Limpar", btnExport: "Exp", btnImport: "Imp", btnReset: "Reset", confirmReset: "Reiniciar tudo?", addRow: "+ Linha", copyAll: "ğŸ“‹ Copiar", calcTitle: "Calculadora", btnSave: "ğŸ’¾ Salvar", btnDone: "Concluir",
                  manual: "ğŸ“– Manual", btnClose: "Fechar", msgSave: "Salvo", msgLoad: "Carregado", confirmDel: "Excluir?", msgExported: "CÃ³digo copiado!", msgError: "Erro", impTitle:"Importar", impDesc:"Cole o cÃ³digo:", btnLoad:"Carregar", memoTitle: "ğŸ“ Nota" },
            fr: { title: "Simple Sheet PRO", masterLabelName: "Titre", masterLabelStart: "ğŸ  Valeur Base", rowLabel: "Nom de l'Ã©lÃ©ment", copyMsg: "CopiÃ© !", btnClear: "Effacer", btnExport: "Exp", btnImport: "Imp", btnReset: "RÃ©tablir", confirmReset: "Tout rÃ©initialiser ?", addRow: "+ Ligne", copyAll: "ğŸ“‹ Copier", calcTitle: "Calculatrice", btnSave: "ğŸ’¾ Enreg.", btnDone: "OK",
                  manual: "ğŸ“– Manuel", btnClose: "Fermer", msgSave: "EnregistrÃ©", msgLoad: "ChargÃ©", confirmDel: "Supprimer ?", msgExported: "Code copiÃ© !", msgError: "Erreur", impTitle:"Importer", impDesc:"Coller code:", btnLoad:"Charger", memoTitle: "ğŸ“ Note" },
            ru: { title: "Simple Sheet PRO", masterLabelName: "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", masterLabelStart: "ğŸ  Ğ‘Ğ°Ğ·Ğ°", rowLabel: "Ğ˜Ğ¼Ñ ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ°", copyMsg: "Ğ¡ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾!", btnClear: "Ğ¡Ğ±Ñ€Ğ¾Ñ", btnExport: "Ğ­ĞºÑĞ¿", btnImport: "Ğ˜Ğ¼Ğ¿", btnReset: "Ğ¡Ğ±Ñ€Ğ¾Ñ", confirmReset: "Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ğ²ÑÑ‘?", addRow: "+ Ğ ÑĞ´", copyAll: "ğŸ“‹ ĞšĞ¾Ğ¿Ğ¸Ñ", calcTitle: "ĞšĞ°Ğ»ÑŒĞºÑƒĞ»ÑÑ‚Ğ¾Ñ€", btnSave: "ğŸ’¾ Ğ¡Ğ¾Ñ…Ñ€.", btnDone: "Ğ“Ğ¾Ñ‚Ğ¾Ğ²Ğ¾",
                  manual: "ğŸ“– Ğ˜Ğ½Ñ„Ğ¾", btnClose: "Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ", msgSave: "Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾!", msgLoad: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½Ğ¾!", confirmDel: "Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ?", msgExported: "ĞšĞ¾Ğ´ ÑĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½!", msgError: "ĞÑˆĞ¸Ğ±ĞºĞ°", impTitle:"Ğ˜Ğ¼Ğ¿Ğ¾Ñ€Ñ‚", impDesc:"Ğ’ÑÑ‚Ğ°Ğ²ÑŒÑ‚Ğµ ĞºĞ¾Ğ´:", btnLoad:"Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ", memoTitle: "ğŸ“ Ğ—Ğ°Ğ¼ĞµÑ‚ĞºĞ°" },
            de: { title: "Simple Sheet PRO", masterLabelName: "Titel", masterLabelStart: "ğŸ  Basiswert", rowLabel: "Elementname", copyMsg: "Kopiert!", btnClear: "LÃ¶schen", btnExport: "Exp", btnImport: "Imp", btnReset: "Reset", confirmReset: "Alles zurÃ¼cksetzen?", addRow: "+ Zeile", copyAll: "ğŸ“‹ Kopieren", calcTitle: "Rechner", btnSave: "ğŸ’¾ Speichern", btnDone: "Fertig",
                  manual: "ğŸ“– Handbuch", btnClose: "SchlieÃŸen", msgSave: "Gespeichert!", msgLoad: "Geladen!", confirmDel: "LÃ¶schen?", msgExported: "Code kopiert!", msgError: "Fehler", impTitle:"Importieren", impDesc:"Code hier einfÃ¼gen:", btnLoad:"Laden", memoTitle: "ğŸ“ Notiz" }
        };

        let currentLanguage = 'en'; 
        let isEditMode = false;
        let currentCalc = "0";
        let isLoading = false; // â˜…ã€é‡è¦ã€‘èª­ã¿è¾¼ã¿ä¸­ã«ã‚»ãƒ¼ãƒ–ã•ã›ãªã„ãŸã‚ã®ãƒãƒªã‚¢

        function init() {
            const langCont = document.getElementById('langContainer');
            Object.keys(languageMap).forEach(lang => {
                const btn = document.createElement('button');
                btn.style.cssText = "padding:4px 6px; font-size:11px; cursor:pointer; border:1px solid #ccc; border-radius:4px; background:#fff; font-weight:bold; color:#000;";
                btn.textContent = lang.toUpperCase();
                btn.onclick = () => setLanguage(lang);
                langCont.appendChild(btn);
            });

            // â˜…å¤‰æ›´ç‚¹ï¼šå…ˆã«ãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã—ã¦ã€ç”»é¢ã‚’ä½œã£ã¦ã—ã¾ã†ï¼
            const savedData = localStorage.getItem('simpleSheetSettings_pro');
            if (savedData) {
                try {
                    applyData(JSON.parse(savedData));
                } catch(e) { 
                    console.error("Restore error", e); 
                    addRow(); // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ç©ºã®è¡Œã‚’ä½œã‚‹
                }
            } else {
                addRow(); // åˆã‚ã¦é–‹ã„ãŸæ™‚ã ã‘ç©ºã®è¡Œã‚’ä½œã‚‹
            }

            // â˜…å¤‰æ›´ç‚¹ï¼šãƒ‡ãƒ¼ã‚¿ãŒå¾©å…ƒã•ã‚ŒãŸã€Œå¾Œã€ã«ã€è¨€èªã‚’è¨­å®šã™ã‚‹ï¼
            // ï¼ˆã“ã‚Œãªã‚‰ã€ã“ã“ã§ã‚ªãƒ¼ãƒˆã‚»ãƒ¼ãƒ–ãŒèµ°ã£ã¦ã‚‚ä¸­èº«ãŒè©°ã¾ã£ã¦ã„ã‚‹ã®ã§æ¶ˆãˆã¾ã›ã‚“ï¼‰
            let savedLang = localStorage.getItem('simpleSheetLang_pro');
            if(!savedLang) {
                const browserLang = navigator.language.slice(0, 2);
                savedLang = languageMap[browserLang] ? browserLang : 'en';
            }
            setLanguage(savedLang); 
            
            renderSaveList();
            updateMemoLinks();
        }

        function setLanguage(lang) {
            currentLanguage = lang; 
            localStorage.setItem('simpleSheetLang_pro', lang);
            const d = languageMap[lang];
            
            document.getElementById('title').textContent = d.title;
            document.getElementById('masterLabel').placeholder = d.masterLabelName;
            document.getElementById('masterLabelStart').textContent = d.masterLabelStart;
            document.getElementById('btnClear').textContent = d.btnClear;
            document.getElementById('btnExport').textContent = d.btnExport;
            document.getElementById('btnImport').textContent = d.btnImport;
            document.getElementById('btnReset').textContent = d.btnReset;
            document.getElementById('addBtn').textContent = d.addRow;
            document.getElementById('copyBtn').textContent = d.copyAll;
            document.getElementById('ui-calcTitle').textContent = d.calcTitle;
            document.getElementById('btnSaveMemory').textContent = d.btnSave;
            document.getElementById('manTitle').textContent = d.manual;
            document.getElementById('manBody').innerText = fullManual[lang] || fullManual['en'];
            document.getElementById('manClose').textContent = d.btnClose;
            document.getElementById('btnManual').textContent = d.manual;
            document.getElementById('impTitle').textContent = d.impTitle;
            document.getElementById('impDesc').textContent = d.impDesc;
            document.getElementById('btnDoImport').textContent = d.btnLoad;
            document.getElementById('btnCloseImp').textContent = d.btnClose;
            if(document.getElementById('memoTitle')) document.getElementById('memoTitle').textContent = d.memoTitle;
            
            const editBtn = document.getElementById('editToggle');
            editBtn.textContent = isEditMode ? 'âœ“' : 'ğŸ—‘ï¸';
            
            document.querySelectorAll('.text-label-input').forEach(input => { input.placeholder = d.rowLabel; });
            updateDisplay();
        }

        // ãƒ­ãƒƒã‚¯ç”»é¢
        const PASS_TEST = "5963"; const PASS_REAL = "5963"; 
        document.addEventListener('DOMContentLoaded', function() {
            if(localStorage.getItem("proWebUnlocked") === "true") { document.getElementById("startLockScreen").style.display = "none"; }
        });
        function checkStartPass() {
            const val = document.getElementById("inputPass").value;
            if(val === PASS_TEST || val === PASS_REAL) { alert("Authenticated!"); localStorage.setItem("proWebUnlocked", "true"); document.getElementById("startLockScreen").style.display = "none"; } 
            else { alert("Wrong Passcode"); document.getElementById("inputPass").value = ""; }
        }

        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function openManual() { document.getElementById('manualModal').classList.add('active'); }
        function openImport() { document.getElementById('importText').value = ""; document.getElementById('importModal').classList.add('active'); }

        function stripError(num) { return parseFloat(num.toPrecision(12)); }
        function formatNum(num) { return stripError(num).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 3 }); }

        function updateDisplay() {
            const masterValStr = document.getElementById('masterInput').value.replace(/[ï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).replace(/ï¼/g, '.');
            const mVal = parseFloat(masterValStr) || 0;
            let chain = mVal;
            document.querySelectorAll('#rows-container .row').forEach(r => {
                const opEl = r.querySelector('.operator-display'); const op = opEl ? opEl.textContent.trim() : '+';
                const inputValStr = r.querySelector('.multiplier-input').value.replace(/[ï¼-ï¼™]/g, s => String.fromCharCode(s.charCodeAt(0) - 0xFEE0)).replace(/ï¼/g, '.');
                const mult = parseFloat(inputValStr) || 0;
                const pct = r.querySelector('.percent-toggle').classList.contains('active');
                const isChain = r.querySelector('.base-toggle').classList.contains('chain');
                const base = isChain ? chain : mVal;
                let mod = pct ? stripError(base * (mult / 100)) : mult;
                let res = 0;
                if(op === '+' || op === 'ï¼‹') res = base + mod;
                else if(op === '-' || op === 'âˆ’' || op === 'ãƒ¼') res = base - mod;
                else if(op === 'Ã—' || op === '*' || op === 'ï¼Š' || op === 'x' || op === 'X') res = pct ? stripError(base * (mult / 100)) : stripError(base * mult);
                else if(op === 'Ã·' || op === '/' || op === 'ï¼') res = mult !== 0 ? stripError(base / mult) : 0;
                else res = base + mod;
                res = stripError(res);
                r.querySelector('.result-text').textContent = formatNum(res);
                chain = res;
            });
            saveSettings(); // è‡ªå‹•çš„ã«ã‚»ãƒ¼ãƒ–ãŒå‘¼ã°ã‚Œã‚‹
        }

        // --- ãƒ¡ãƒ¢å¸³ã®URLãƒªãƒ³ã‚¯æ©Ÿèƒ½ ---
        function updateMemoLinks() {
            const text = document.getElementById('memoArea').value;
            const linkDiv = document.getElementById('memoLinks');
            linkDiv.innerHTML = '';
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const matches = text.match(urlRegex);
            if(matches) {
                matches.forEach(url => {
                    const a = document.createElement('a');
                    a.href = url;
                    a.target = '_blank';
                    a.className = 'memo-link-item';
                    a.textContent = "ğŸŒ " + (url.length > 35 ? url.substring(0,32)+"..." : url);
                    linkDiv.appendChild(a);
                });
            }
        }

        function getScreenData() {
            return {
                n: document.getElementById('masterLabel').value, 
                b: document.getElementById('masterInput').value, 
                m: document.getElementById('memoArea').value, 
                r: Array.from(document.querySelectorAll('#rows-container .row')).map(r => {
                    let rawVal = r.querySelector('.multiplier-input').value;
                    return {
                        n: r.querySelector('.text-label-input').value, 
                        p: rawVal === "" ? "" : parseFloat(rawVal), // ç©ºæ¬„ã‚’0ã«ã›ãšç©ºæ¬„ã®ã¾ã¾ä¿æŒ
                        o: r.querySelector('.operator-display').textContent.trim(), 
                        pct: r.querySelector('.percent-toggle').classList.contains('active'), 
                        c: r.querySelector('.base-toggle').classList.contains('chain') 
                    };
                })
            };
        }

        function applyData(s) {
            if(!s) return;
            isLoading = true; // â˜…ãƒãƒªã‚¢ONï¼šå¾©å…ƒä¸­ã¯ã‚»ãƒ¼ãƒ–ã•ã›ãªã„

            document.getElementById('masterLabel').value = s.n || s.name || s.masterLabel || '';
            document.getElementById('masterInput').value = s.b || s.base || s.masterInput || '';
            document.getElementById('memoArea').value = s.m || s.memo || '';
            
            document.getElementById('rows-container').innerHTML = ''; // ç”»é¢ã‚’ä¸€åº¦ãƒªã‚»ãƒƒãƒˆ
            
            let rowsToLoad = s.r || s.rows || s.simpleRows;
            if(rowsToLoad && rowsToLoad.length > 0) { 
                rowsToLoad.forEach(r => {
                    let op = r.o || r.operator || '+';
                    let label = r.n || r.label || '';
                    let val = (r.p !== undefined) ? r.p : (r.multiplier !== undefined ? r.multiplier : '');
                    let isPct = (r.pct !== undefined) ? r.pct : (r.isPercentActive || false);
                    let isChain = (r.c !== undefined) ? r.c : (r.baseMode === 'chain');
                    
                    let rowData = {
                        label: label, multiplier: val, operator: op, isPercentActive: isPct, baseMode: isChain ? 'chain' : 'master'
                    };
                    addRow(rowData);
                }); 
            } else { 
                addRow(); 
            }
            
            updateMemoLinks();
            
            isLoading = false; // â˜…ãƒãƒªã‚¢OFFï¼šå¾©å…ƒå®Œäº†
            updateDisplay(); // æœ€å¾Œã«1å›ã ã‘ç¶ºéº—ã«ã‚»ãƒ¼ãƒ–ã•ã›ã‚‹
        }

        function saveSettings(){ 
            if (isLoading) return; // â˜…ãƒãƒªã‚¢ä¸­ã¯ã‚»ãƒ¼ãƒ–ã‚’å¼¾ã
            localStorage.setItem('simpleSheetSettings_pro', JSON.stringify(getScreenData())); 
        }

        function toggleEditMode() {
            isEditMode = !isEditMode;
            const btn = document.getElementById('editToggle');
            btn.classList.toggle('active', isEditMode);
            btn.textContent = isEditMode ? 'âœ“' : 'ğŸ—‘ï¸';
            document.getElementById('saveList').classList.toggle('editing', isEditMode);
        }

        function saveToMemory() {
            const data = getScreenData();
            const name = data.n || "No Name";
            let lib = JSON.parse(localStorage.getItem('sheetLibrary_pro') || '[]');
            lib.push({ id: Date.now(), name: name, content: data });
            localStorage.setItem('sheetLibrary_pro', JSON.stringify(lib));
            renderSaveList();
            showMsg(languageMap[currentLanguage].msgSave);
        }

        function renderSaveList() {
            const cont = document.getElementById('saveList');
            const lib = JSON.parse(localStorage.getItem('sheetLibrary_pro') || '[]');
            cont.innerHTML = '';
            lib.slice().reverse().forEach(item => {
                const chip = document.createElement('div');
                chip.className = 'save-chip';
                const nameSpan = document.createElement('span');
                nameSpan.textContent = item.name;
                const delIcon = document.createElement('span');
                delIcon.className = 'del-icon';
                delIcon.textContent = 'ğŸ—‘';
                chip.appendChild(nameSpan); chip.appendChild(delIcon);
                chip.onclick = () => {
                    if(isEditMode) deleteMemory(item.id);
                    else { applyData(item.content); showMsg(languageMap[currentLanguage].msgLoad); }
                };
                cont.appendChild(chip);
            });
        }

        function deleteMemory(id) {
            if(confirm(languageMap[currentLanguage].confirmDel)) {
                let lib = JSON.parse(localStorage.getItem('sheetLibrary_pro') || '[]');
                lib = lib.filter(i => i.id !== id);
                localStorage.setItem('sheetLibrary_pro', JSON.stringify(lib));
                renderSaveList();
            }
        }

        function escapeForExcel(text) {
            if (!text) return "";
            let str = String(text);
            str = str.replace(/\t/g, ' '); 
            str = str.replace(/"/g, '""'); 
            if (str.search(/[\n\r"]/) >= 0) {
                str = `"${str}"`; 
            }
            return str;
        }

        function escapeHtml(str) {
            if(!str) return "";
            return str.replace(/[&<>"']/g, function(m) {
                return {
                    '&': '&amp;',
                    '<': '&lt;',
                    '>': '&gt;',
                    '"': '&quot;',
                    "'": '&#039;'
                }[m];
            });
        }

        function insertAutoBreaks(text) {
            let res = "";
            const lines = text.split('\n');
            lines.forEach((line, idx) => {
                if(line.length > 40) {
                    for(let i=0; i<line.length; i+=40) {
                        res += escapeHtml(line.substr(i, 40)) + "<br>";
                    }
                } else {
                    res += escapeHtml(line) + "<br>";
                }
            });
            return res;
        }

        // --- Copy Logic (HTML + Text) ---
        async function copyPage() { 
            const title = document.getElementById('masterLabel').value || 'Sheet';
            const baseLabel = languageMap[currentLanguage].masterLabelStart;
            const baseVal = document.getElementById('masterInput').value;
            
            // Text Format
            let t = `ã€${escapeForExcel(title)}ã€‘\n`;
            t += `${baseLabel}\t\t${baseVal}\n`;
            
            // HTML Format
            let h = `<table>`;
            h += `<tr><td colspan="3" style="background-color:#EFEFEF; text-align:center; font-size:14pt;">ã€${escapeHtml(title)}ã€‘</td></tr>`;
            h += `<tr><td>${escapeHtml(baseLabel)}</td><td></td><td>${escapeHtml(baseVal)}</td></tr>`;

            document.querySelectorAll('#rows-container .row').forEach(r => { 
                const label = r.querySelector('.text-label-input').value || '-';
                const val = r.querySelector('.result-text').textContent.replace(/,/g,'');
                
                t += `${escapeForExcel(label)}\t\t${val}\n`; 
                h += `<tr><td>${escapeHtml(label)}</td><td></td><td>${escapeHtml(val)}</td></tr>`;
            });
            
            const memo = document.getElementById('memoArea').value;
            if(memo) {
                t += `\n[Memo]\n${escapeForExcel(memo)}`;
                const htmlMemo = insertAutoBreaks(memo);
                h += `<tr><td colspan="3" style="background-color:#FFF2CC; vertical-align:top; white-space:normal; word-wrap:break-word;"><b>[ Memo ]</b><br>${htmlMemo}</td></tr>`;

                const urlRegex = /(https?:\/\/[^\s]+)/g;
                const matches = memo.match(urlRegex);
                if(matches) {
                    t += "\n[Links]\n";
                    h += `<tr><td colspan="3" style="background-color:#EFEFEF; font-weight:bold;">[ Links ]</td></tr>`;
                    matches.forEach(url => {
                        t += `${url}\n`;
                        h += `<tr><td colspan="3"><a href="${url}" target="_blank">${url}</a></td></tr>`;
                    });
                }
            }
            h += `</table>`;

            try {
                const blobText = new Blob([t], { type: 'text/plain' });
                const blobHtml = new Blob([h], { type: 'text/html' });
                const item = new ClipboardItem({ 
                    'text/plain': blobText, 
                    'text/html': blobHtml 
                });
                await navigator.clipboard.write([item]);
                showMsg(languageMap[currentLanguage].copyMsg);
            } catch (err) {
                navigator.clipboard.writeText(t);
                showMsg(languageMap[currentLanguage].copyMsg + " (Text)");
            }
        }

        function exportData() { 
            const data = getScreenData();
            const jsonCode = JSON.stringify(data);
            
            let output = "";
            const title = data.n || "Simple Sheet";
            output += `ã€ ${title} ã€‘\n\n`;
            
            const memo = data.m || "";
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const matches = memo.match(urlRegex);
            if(matches && matches.length > 0) {
                output += "[Links]\n";
                matches.forEach(url => { output += `${url}\n`; });
                output += "\n";
            }
            
            output += "â–¼ DATA CODE â–¼\n";
            output += jsonCode;
            
            navigator.clipboard.writeText(output); 
            showMsg(languageMap[currentLanguage].msgExported); 
        }

        // --- Import (å…¨ç’°å¢ƒå¯¾å¿œãƒ»æœ€çµ‚ç‰ˆ) ---
        function executeImport() {
            let rawText = document.getElementById('importText').value;
            if(!rawText) return;
            
            let cleanText = rawText
                .replace(/\u00A0/g, " ")
                .replace(/\u200B/g, "")
                .replace(/\u200E/g, "")
                .replace(/[â€œâ€]/g, '"')
                .replace(/```json/g, "")
                .replace(/```/g, "")
                .trim();

            const marker = "â–¼ DATA CODE â–¼";
            if (cleanText.includes(marker)) {
                cleanText = cleanText.split(marker)[1].trim();
            }

            const firstBrace = cleanText.indexOf('{');
            const lastBrace = cleanText.lastIndexOf('}');
            
            if (firstBrace !== -1 && lastBrace !== -1 && firstBrace < lastBrace) {
                let jsonPart = cleanText.substring(firstBrace, lastBrace + 1);
                
                jsonPart = jsonPart.replace(/\\n/g, "Â§NÂ§");
                jsonPart = jsonPart.replace(/\\([^n\\])/g, '$1');
                jsonPart = jsonPart.replace(/\n/g, "").replace(/\r/g, "");
                jsonPart = jsonPart.replace(/Â§NÂ§/g, "\\n");

                try {
                    const j = JSON.parse(jsonPart);
                    applyData(j);
                    showMsg(languageMap[currentLanguage].msgLoad);
                    closeModal('importModal');
                    return;
                } catch(e) {
                    console.error("JSON Parse Error:", e);
                }
            }

            if(tryParseText(rawText)){ 
                showMsg(languageMap[currentLanguage].msgLoad);
                closeModal('importModal');
            } else {
                showMsg(languageMap[currentLanguage].msgError);
            }
        }

        function addRow(s=null) {
            const id = s && s.id ? s.id : Math.random().toString(36).substr(2, 5);
            const ph = languageMap[currentLanguage].rowLabel;
            const div = document.createElement('div'); div.className = 'row'; div.dataset.id = id;
            const isChain = s ? (s.baseMode==='chain') : true; 
            const val = s ? s.multiplier : '';

            div.innerHTML = `
                <input type="text" class="text-label-input" placeholder="${ph}" value="${s?s.label:''}" oninput="saveSettings()">
                <div class="calc-area">
                    <div id="base-${id}" class="base-toggle ${isChain?'chain':''}" onclick="this.classList.toggle('chain');this.textContent=this.classList.contains('chain')?'ğŸ”—':'ğŸ ';updateDisplay()">
                        ${isChain?'ğŸ”—':'ğŸ '}
                    </div>
                    <div class="operator-group">
                        <div class="operator-control" onclick="changeOp('${id}',1)">â–²</div>
                        <div class="operator-display" id="op-${id}">${s?s.operator:'+'}</div>
                        <div class="operator-control" onclick="changeOp('${id}',-1)">â–¼</div>
                    </div>
                    <input type="number" step="any" class="multiplier-input" value="${val}" placeholder="" oninput="updateDisplay()">
                    <div class="percent-toggle ${s&&s.isPercentActive?'active':''}" onclick="this.classList.toggle('active');updateDisplay()">%</div>
                </div>
                <div class="result-area">
                    <div class="result-text">0</div>
                    <div style="display:flex; gap:10px;">
                        <button class="action-btn" onclick="copyRowVal(this)">ğŸ“‹</button>
                        <button class="action-btn" onclick="this.closest('.row').remove();updateDisplay()">ğŸ—‘ï¸</button>
                    </div>
                </div>
            `;
            document.getElementById('rows-container').appendChild(div); 
            updateDisplay(); // ã“ã“ã§saveSettingsã‚‚å‘¼ã°ã‚Œã‚‹
        }

        function changeOp(id, d) { 
            const ops = ['+','-','Ã—','Ã·']; 
            const el = document.getElementById('op-'+id);
            const currentOp = el.textContent.trim();
            el.textContent = ops[(ops.indexOf(currentOp) + d + 4) % 4]; 
            updateDisplay(); 
        }

        function copyRowVal(btn) { 
            navigator.clipboard.writeText(btn.closest('.result-area').querySelector('.result-text').textContent.replace(/,/g,'')); 
            showMsg(languageMap[currentLanguage].copyMsg); 
        }

        function tryParseText(text) {
             const lines = text.trim().split(/\r?\n/);
            if (lines.length < 1) return false;
            let name = ""; let base = 0; let rows = []; let startRowIdx = 0;
            const titleMatch = lines[0].match(/ã€(.*?)ã€‘/);
            if (titleMatch) { name = titleMatch[1]; startRowIdx = 1; } 
            else if (!isNaN(parseFloat(lines[0])) && lines[0].trim().match(/^[\d\.-]+$/)) { base = parseFloat(lines[0]); startRowIdx = 1; } 
            
            if (startRowIdx < lines.length) {
                const rowText = lines[startRowIdx];
                const baseValMatch = rowText.match(/[\d\.-]+/);
                if (rowText.includes("Base") || rowText.includes("å…ƒ") || rowText.includes("Initial") || (!rowText.includes("\t") && baseValMatch)) {
                    if (baseValMatch) base = parseFloat(baseValMatch[0]);
                    startRowIdx++;
                }
            }

            let readingMemo = false;
            let memoContent = "";

            for (let i = startRowIdx; i < lines.length; i++) {
                const line = lines[i].trim(); if (!line) continue;
                if (line.includes("[Memo]") || line.includes("â–¼ DATA CODE")) { readingMemo = true; continue; }
                if (readingMemo) { 
                    if(line.includes("â–¼ DATA CODE")) break; 
                    if (!line.startsWith("Link\t")) {
                        memoContent += line + "\n"; 
                    }
                    continue; 
                }

                let parts = line.split(/\t+/); if (parts.length < 2) parts = line.split(/\s{2,}/);
                
                if (parts.length >= 2) {
                    let valStr = parts[parts.length-1].replace(/,/g, '');
                    if (!isNaN(parseFloat(valStr))) {
                        const val = parseFloat(valStr);
                        const label = parts.slice(0, parts.length-1).join(" ").trim();
                        rows.push({ label: label, multiplier: val, operator: '+', baseMode: 'chain', isPercentActive: false });
                    }
                }
            }
            
            if (rows.length === 0 && base === 0 && !name) return false;
            document.getElementById('masterLabel').value = name; 
            document.getElementById('masterInput').value = base;
            document.getElementById('memoArea').value = memoContent.trim();
            updateMemoLinks();
            document.getElementById('rows-container').innerHTML = "";
            rows.forEach(r => addRow(r)); updateDisplay();
            return true;
        }

        function calcInput(v) { if(v === 'AC') { currentCalc = "0"; } else if(v === 'BS') { currentCalc = currentCalc.length > 1 ? currentCalc.slice(0, -1) : "0"; } else { if(currentCalc === "0" && v !== ".") currentCalc = v; else currentCalc += v; } document.getElementById('calcDisplay').value = currentCalc; }
        function calcResult() { try { let expression = currentCalc.replace(/Ã—/g, '*').replace(/Ã·/g, '/').replace(/%/g, '/100'); let res = eval(expression); currentCalc = stripError(res).toString(); } catch(e) { currentCalc = "Error"; } document.getElementById('calcDisplay').value = currentCalc; }
        function copyCalcResult() { navigator.clipboard.writeText(document.getElementById('calcDisplay').value); showMsg(languageMap[currentLanguage].copyMsg); }
        function toggleCalc() { document.getElementById('sideCalc').classList.toggle('active'); }
        function clearNumbers() { document.getElementById('masterInput').value = ""; document.querySelectorAll('.multiplier-input').forEach(i => i.value = ""); document.getElementById('memoArea').value = ""; updateMemoLinks(); updateDisplay(); }
        function fullReset() { if(confirm(languageMap[currentLanguage].confirmReset)) { localStorage.removeItem('simpleSheetSettings_pro'); location.reload(); } }
        function showMsg(t) { const m = document.getElementById('saveMessage'); m.textContent = t; m.style.opacity = 1; setTimeout(() => m.style.opacity = 0, 1500); }

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW failed', err));
            });
        }
    </script>
</body>
</html>
